const translations = {
    en: { search: "Search pet...", demand: "Demand", normal: "Normal", golden: "Golden", rainbow: "Rainbow", updated: "Updated" },
    pl: { search: "Szukaj peta...", demand: "Popyt", normal: "Normalny", golden: "Złoty", rainbow: "Tęczowy", updated: "Aktualizacja" },
    fr: { search: "Rechercher...", demand: "Demande", normal: "Normal", golden: "Doré", rainbow: "Arc-en-ciel", updated: "Mis à jour" },
    es: { search: "Buscar...", demand: "Demanda", normal: "Normal", golden: "Dorado", rainbow: "Arcoíris", updated: "Actualizado" },
    de: { search: "Suche...", demand: "Nachfrage", normal: "Normal", golden: "Golden", rainbow: "Regenbogen", updated: "Aktualisiert" }
};

const INITIAL_DATA = [
    { name: "Krampus", category: "Secrets", demand: "8/10", val: "2,300", img: "images/Krampus.png", updated: "12/26/2025" },
    { name: "Evil Snowman", category: "Secrets", demand: "8/10", val: "120", img: "images/Evil Snowman.png", updated: "12/26/2025" },
    { name: "Gilded Seraphim", category: "Legendary", demand: "10/10", val: "1,350", img: "images/Gilded Seraphim.png", updated: "12/26/2025" },
    { name: "Ornament", category: "Mythical", demand: "8/10", val: "0.2", img: "images/Ornament.png", updated: "12/26/2025" },
    { name: "Nutcracker", category: "Secrets", demand: "10/10", val: "4", img: "images/Nutcracker.png", updated: "12/26/2025" },
    { name: "Frost Spirit", category: "Secrets", demand: "8/10", val: "75", img: "images/Frost Spirit.png", updated: "12/26/2025" },
    { name: "Christmas Tree", category: "Mythical", demand: "8/10", val: "175", img: "images/Christmas Tree.png", updated: "12/26/2025" },
    { name: "Sharkie", category: "Limited", demand: "4/10", val: "4", img: "images/Sharkie.png", updated: "12/26/2025" },
    { name: "5m Frost Monarch", category: "Limited", demand: "5/10", val: "1,350", img: "images/5m Frost Monarch.png", updated: "12/26/2025" },
    { name: "5m North Star", category: "Mythical", demand: "4/10", val: "200", img: "images/5m North Star.png", updated: "12/26/2025" },
    { name: "Archangel", category: "Mythical", demand: "0/10", val: "1", img: "images/Archangel.png", updated: "12/25/2025" },
    { name: "BubbleGum Chaos", category: "Secrets", demand: "2/10", val: "0.1", img: "images/BubbleGum Chaos.png", updated: "12/25/2025" },
    { name: "Candy God", category: "Secrets", demand: "3/10", val: "55", img: "images/Candy God.png", updated: "12/26/2025" },
    { name: "Chocolate Marauder", category: "Percentage", demand: "3/10", val: "340", img: "images/Chocolate Marauder.png", updated: "12/26/2025" },
    { name: "Chronos", category: "Leaderboard", demand: "8/10", val: "9,500", img: "images/Chronos.png", updated: "12/26/2025" },
    { name: "Divine Celestia", category: "Secrets", demand: "10/10", val: "12,000", img: "images/Divine Celestia.png", updated: "12/26/2025" },
    { name: "Divine Dragon", category: "Secrets", demand: "3/10", val: "30", img: "images/Divine Dragon.png", updated: "12/26/2025" },
    { name: "Frost Queen", category: "Limited", demand: "4/10", val: "65", img: "images/Frost Queen.png", updated: "12/26/2025" },
    { name: "Frosty Snowman", category: "Limited", demand: "9/10", val: "180", img: "images/Frosty Snowman.png", updated: "12/26/2025" },
    { name: "Gingerbread Dragon", category: "Percentage", demand: "4/10", val: "2", img: "images/Gingerbread Dragon.png", updated: "12/26/2025" },
    { name: "Kairos", category: "Mythical", demand: "6/10", val: "115", img: "images/Kairos.png", updated: "12/26/2025" },
    { name: "King Emblazed", category: "Secrets", demand: "1/10", val: "0.1", img: "images/King Emblazed.png", updated: "12/26/2025" },
    { name: "King Kraken", category: "Secrets", demand: "6/10", val: "400", img: "images/King Kraken.png", updated: "12/26/2025" },
    { name: "Magmasaur", category: "Secrets", demand: "4/10", val: "50", img: "images/Magmasaur.png", updated: "12/26/2025" },
    { name: "Orca Dominator", category: "Percentage", demand: "4/10", val: "55", img: "images/Orca Dominator.png", updated: "12/26/2025" },
    { name: "Paradox", category: "Secrets", demand: "7/10", val: "170", img: "images/Paradox.png", updated: "12/26/2025" },
    { name: "Raging Claw", category: "Secrets", demand: "2/10", val: "70", img: "images/Raging Claw.png", updated: "12/26/2025" },
    { name: "Sakura Dominator", category: "Mythical", demand: "3/10", val: "75", img: "images/Sakura Dominator.png", updated: "12/26/2025" },
    { name: "Sakura Queen", category: "Mythical", demand: "0/10", val: "0.1", img: "images/Sakura Queen.png", updated: "12/26/2025" },
    { name: "Samureye", category: "Leaderboard", demand: "0/10", val: "0.1", img: "images/Samureye.png", updated: "12/26/2025" },
    { name: "Silver Emperor", category: "Percentage", demand: "8/10", val: "1,050", img: "images/Silver Emperor.png", updated: "12/26/2025" },
    { name: "Social Dragon", category: "Leaderboard", demand: "5/10", val: "14", img: "images/Social Dragon.png", updated: "12/26/2025" },
    { name: "Trophy Guardian", category: "Secrets", demand: "8/10", val: "550", img: "images/Trophy Guardian.png", updated: "12/26/2025" },
    { name: "Weeping Angel", category: "Secrets", demand: "2/10", val: "45", img: "images/Weeping Angel.png", updated: "12/26/2025" }
];

let currentLang = 'en';
let currentCategory = 'Home';
let calcItems = [];
let pets = INITIAL_DATA;

const parseVal = (v) => {
    if (!v || v.toString() === "O/C") return 0;
    return parseFloat(v.toString().replace(/,/g, '')) || 0;
};

const formatVal = (v) => {
    if (v >= 1000000) return (v / 1000000).toFixed(2) + "M";
    if (v >= 1000) return (v / 1000).toFixed(1) + "K";
    return v.toLocaleString();
};

function changeLanguage() {
    currentLang = document.getElementById('langSelect').value;
    document.getElementById('search').placeholder = translations[currentLang].search;
    render();
}

function setCategory(cat) {
    currentCategory = cat;
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b.innerText.includes(cat)));
    render();
}

function render() {
    const grid = document.getElementById('petGrid');
    const search = document.getElementById('search').value.toLowerCase();
    const sort = document.getElementById('sortOrder').value;
    const t = translations[currentLang];
    grid.innerHTML = "";

    let filtered = pets.filter(p => {
        const matchesSearch = p.name.toLowerCase().includes(search);
        const matchesCat = (currentCategory === 'Home' || p.category === currentCategory);
        return matchesSearch && matchesCat;
    });

    if (sort === "valHigh") filtered.sort((a, b) => parseVal(b.val) - parseVal(a.val));
    if (sort === "valLow") filtered.sort((a, b) => parseVal(a.val) - parseVal(b.val));
    if (sort === "demandHigh") filtered.sort((a, b) => parseInt(b.demand) - parseInt(a.demand));

    filtered.forEach(p => {
        const n = parseVal(p.val);
        const g = n >= 999999 ? p.val : (n * 5).toLocaleString();
        const r = n >= 999999 ? p.val : (n * 25).toLocaleString();

        grid.innerHTML += `
            <div class="glass p-5 rounded-2xl pet-card flex flex-col transition border-t-2 border-blue-500/50">
                <div class="h-32 flex items-center justify-center bg-blue-900/10 rounded-xl mb-4 p-2 relative">
                    <img src="${p.img}" class="max-h-full drop-shadow-2xl" onerror="this.src='https://via.placeholder.com/100?text=PET'">
                    <span class="absolute top-2 right-2 text-[8px] bg-blue-600/30 px-2 py-0.5 rounded text-blue-300 font-bold uppercase tracking-widest">${p.category}</span>
                </div>
                <h3 class="orbitron text-md font-bold text-white mb-1">${p.name}</h3>
                <div class="text-[9px] text-slate-400 font-bold mb-4 uppercase tracking-wider">${t.demand}: <span class="text-blue-400">${p.demand}</span></div>
                
                <div class="space-y-2 mb-4">
                    <button onclick="addToCalc('${p.name}', '${p.val}', 'Normal')" class="w-full flex justify-between items-center bg-white/5 p-2 rounded-lg hover:bg-blue-600/20 transition group border border-transparent hover:border-blue-500/50">
                        <span class="text-[10px] text-slate-400 uppercase flex items-center gap-1">
                            <span class="text-blue-500 font-bold text-lg">+</span> ${t.normal}
                        </span>
                        <span class="text-sm font-bold text-white group-hover:text-blue-400">${p.val}</span>
                    </button>

                    <button onclick="addToCalc('${p.name}', '${g}', 'Golden')" class="w-full flex justify-between items-center bg-white/5 p-2 rounded-lg hover:bg-yellow-600/20 transition group border border-transparent hover:border-yellow-500/50 text-yellow-500">
                        <span class="text-[10px] uppercase opacity-70 italic flex items-center gap-1">
                            <span class="text-yellow-500 font-bold text-lg">+</span> ${t.golden}
                        </span>
                        <span class="text-sm font-bold group-hover:text-yellow-400">${g}</span>
                    </button>

                    <button onclick="addToCalc('${p.name}', '${r}', 'Rainbow')" class="w-full flex justify-between items-center bg-white/5 p-2 rounded-lg hover:bg-pink-600/20 transition group border border-transparent hover:border-pink-500/50 text-pink-500">
                        <span class="text-[10px] uppercase opacity-70 italic flex items-center gap-1">
                            <span class="text-pink-500 font-bold text-lg">+</span> ${t.rainbow}
                        </span>
                        <span class="text-sm font-bold group-hover:text-pink-400">${r}</span>
                    </button>
                </div>
                <div class="mt-auto text-[8px] text-slate-600 uppercase font-bold tracking-widest italic font-mono text-center">${t.updated}: ${p.updated}</div>
            </div>`;
    });
}

function addToCalc(name, val, type) {
    calcItems.push({ name, val, type });
    updateCalc();
}

function removeFromCalc(idx) {
    calcItems.splice(idx, 1);
    updateCalc();
}

function clearCalc() {
    calcItems = [];
    updateCalc();
}

function updateCalc() {
    const list = document.getElementById('calcList');
    const totalEl = document.getElementById('totalValue');
    let total = 0;

    if (calcItems.length === 0) {
        list.innerHTML = `<p class="text-slate-500 text-xs text-center py-4 italic">Calculator is empty.</p>`;
        totalEl.innerText = "0";
        return;
    }

    list.innerHTML = "";
    calcItems.forEach((item, idx) => {
        total += parseVal(item.val);
        list.innerHTML += `
            <div class="flex justify-between items-center bg-white/5 p-3 rounded-xl text-xs animate-fadeIn border-l-2 ${item.type === 'Golden' ? 'border-yellow-500' : item.type === 'Rainbow' ? 'border-pink-500' : 'border-blue-500'}">
                <div class="truncate pr-2">
                    <div class="font-bold text-white">${item.name}</div>
                    <div class="text-[8px] uppercase opacity-50 font-bold">${item.type}</div>
                </div>
                <div class="flex items-center gap-2">
                    <span class="font-bold text-blue-400">${item.val}</span>
                    <button onclick="removeFromCalc(${idx})" class="text-red-500 hover:text-red-400 text-xl leading-none">&times;</button>
                </div>
            </div>`;
    });
    totalEl.innerText = formatVal(total);
}

setInterval(() => {
    const el = document.getElementById('userCount');
    if(el) el.innerText = Math.floor(Math.random() * 8) + 14;
}, 5000);

function adminAuth() { if(prompt("Pass:") === "cosmo123") alert("Admin login successful!"); }

document.addEventListener('DOMContentLoaded', () => {
    const uc = document.getElementById('userCount');
    if(uc) uc.innerText = "16";
    render();
});
